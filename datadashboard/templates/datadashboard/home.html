{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>OU Parking — Data Dashboard</title>

  <!-- Same banner style as your partner's page -->
  <style>
    body { font-family: Arial, sans-serif; margin: 0; }
    .banner {
      width: 100vw;
      height: 12vh;
      background-color: #f73206ff; /* OU crimson */
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2rem;
      font-weight: bold;
      margin: 0;
      padding: 0;
      position: relative;
    }
    .banner-logo { height: 75px; width: auto; }
    .banner-title { flex: 1; text-align: center; font-size: 2rem; font-weight: bold; }
    /* page content wrapper */
    .wrap { max-width: 1100px; margin: 28px auto 80px; padding: 0 20px; }
    /* simple table styling you already use */
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 14px 16px; border-bottom: 1px solid #e5e7eb; }
    th { background: #1f2937; color: #fff; text-align: left; }
    .num { width: 56px; color: #6B7280; }
    .title { text-align: center; font-size: 48px; font-weight: 800; margin: 18px 0 28px; }
    .empty { text-align: center; color: #6B7280; padding: 20px; background: #f3f4f6; }
  </style>
</head>

<body>
  <!-- OU RED BANNER (logo → Home) -->
  <div class="banner">
    <a href="{% url 'home' %}">
      <img src="{% static 'parkinglotlocater/images/banner.png' %}" alt="OU" class="banner-logo" />
    </a>
    <div class="banner-title">OU Parking App</div>
  </div>

  <div class="wrap">
    <h1 class="title">Data Dashboard</h1>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Building</th>
        <th>Closest Lot</th>
        <th>Available / Total</th>
      </tr>
    </thead>
    <tbody>
  {% for r in rows %}
    <tr>
      <td class="num">{{ forloop.counter }}</td>
      <td>{{ r.building }}</td>
      <td>{{ r.lot_label }}</td>
      <td>
        {% if r.available != None and r.total != None %}
          {{ r.available }} / {{ r.total }}
        {% else %}
          &mdash;
        {% endif %}
      </td>
    </tr>
  {% empty %}
    <tr>
      <td colspan="4" class="empty">No data.</td>
    </tr>
  {% endfor %}
</tbody>

  </table>
  <style>
  .subtle { color:#6b7280; font-size:14px; margin-top:4px; }
  .peakcard { margin-top:28px; border:1px solid #e5e7eb; border-radius:12px; overflow:hidden}
  .peakcard h2 { margin:0; padding:14px 16px; background:#f3f4f6; }
  .peaktable { width:100%; border-collapse:separate; border-spacing:0; }
  .peaktable th, .peaktable td { padding:10px 12px; border-bottom:1px solid #e5e7eb; }
  .peaktable tr:last-child td { border-bottom:none; }
  .wk { width:110px; color:#374151; }
  .hr { font-weight:600; }
</style>

<div class="peakcard">
  <h2>Typical Peak Hours <span class="subtle">(last 60 days)</span></h2>

  {% comment %} Show one block per lot we know about {% endcomment %}
  {% for lot_code, peak in peaks.items %}
    <div style="padding:14px 16px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="font-weight:700">Lot: {{ lot_code }}</div>
        {% if peak.overall %}
          <div class="subtle">Overall busiest hour: <strong>{{ peak.overall.hour }}:00</strong></div>
        {% endif %}
      </div>
      <table class="peaktable">
        <thead>
          <tr>
            <th class="wk">Weekday</th>
            <th>Typical Peak Hour</th>
            <th>Avg. Occupied (sum)</th>
          </tr>
        </thead>
        <tbody>
          {% for r in peak.by_weekday %}
            <tr>
              <td class="wk">
                {% if r.weekday == 1 %}Sun{% elif r.weekday == 2 %}Mon{% elif r.weekday == 3 %}Tue{% elif r.weekday == 4 %}Wed{% elif r.weekday == 5 %}Thu{% elif r.weekday == 6 %}Fri{% else %}Sat{% endif %}
              </td>
              <td class="hr">{{ r.hour }}:00</td>
              <td>{{ r.avg_occupied }}</td>
            </tr>
          {% empty %}
            <tr><td colspan="3" class="subtle">No historical data for this lot.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% if not forloop.last %}<hr style="border:none;border-top:1px solid #e5e7eb;margin:0">{% endif %}
  {% endfor %}
</div>

</body>
</html>
